#!/sbin/sh
#

OUTFD=$2
ZIP=$3

SYSTEMLIB=/system/lib

ui_print() {
  echo -n -e "ui_print $1\n" > /proc/self/fd/$OUTFD
  echo -n -e "ui_print\n" > /proc/self/fd/$OUTFD
}

cp_perm() {
  rm $5
  if [ -f "$4" ]; then
    cat $4 > $5
    set_perm $1 $2 $3 $5 $6
  fi
}

ui_print "*****************"
ui_print "OSS installer"
ui_print "*****************"

ui_print "- Mounting /system, /data and rootfs"
mount /system
mount /data
mount -o rw,remount /system
mount -o rw,remount /system /system
mount -o rw,remount /
mount -o rw,remount / /


APKNAME=/system/app/ESExplorer.apk
BOOTANIM=/system/media/bootanimation.zip

ui_print "- Creating temp dir"
COM=/tmp/oss/common
cd /
mkdir tmp
cd tmp
mkdir oss
cd oss
ui_print "- Entered temp dir"
pwd
ls
ui_print "- Unpacking"

unzip -o "$ZIP"

ls 

ui_print "- Copying files"

rm -f $APKNAME
rm -f $BOOTANIM

ls /system/media

cp_perm 0 0 0644 $COM/com.estrongs.android.pop.apk $APKNAME
cp_perm 0 0 0644 $COM/bootanimation.zip $BOOTANIM

ui_print "- Copyied files"

ls /system/media

ui_print "- Unmounting /system and /data"
umount /system
umount /data

ui_print "- Done !"
exit 0
